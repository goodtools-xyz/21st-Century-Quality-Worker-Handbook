# 异常值检验 - 依据ISO 16269-4-2010

## 概念简介

异常值检验（Outlier Detection）是统计过程控制中的重要组成部分，用于识别数据集中明显偏离其他观测值的异常数据点。根据ISO 16269-4-2010《数据统计分析 - 第4部分：检测离群值的方法》标准，异常值可能来自测量错误、实验误差或过程中的特殊原因变异，正确识别和处理异常值对于确保统计分析的准确性至关重要。

## 参考标准

- ISO 16269-4-2010：数据统计分析 - 第4部分：检测离群值的方法

## 异常值的分类

根据ISO 16269-4-2010，异常值可分为以下几类：

1. **单侧异常值**：仅在数据分布的一侧出现的异常值（极大值或极小值）
2. **双侧异常值**：在数据分布的两侧同时出现的异常值
3. **单个异常值**：数据集中仅存在一个异常值
4. **多个异常值**：数据集中存在多个异常值

## 异常值检验方法

ISO 16269-4-2010规定了多种异常值检验方法，适用于不同的数据分布和应用场景：

### 1. 基于正态分布的检验方法

#### 1.1 Grubbs检验（单侧/双侧）
- **适用条件**：数据呈正态分布，检验单个异常值
- **检验统计量**：
  - 单侧检验：$G = \frac{|X_{(n)} - \bar{X}|}{s}$ 或 $G = \frac{|X_{(1)} - \bar{X}|}{s}$
  - 双侧检验：$G = \frac{\max|X_i - \bar{X}|}{s}$
- **判断准则**：若G > 临界值，则判定为异常值

#### 1.2 Dixon检验（单侧/双侧）
- **适用条件**：数据呈正态分布，样本量较小（3 ≤ n ≤ 30）
- **检验统计量**：
  - 对于小样本（3 ≤ n ≤ 7）：$r_{10} = \frac{X_{(n)} - X_{(n-1)}}{X_{(n)} - X_{(1)}}$ 或 $r_{10} = \frac{X_{(2)} - X_{(1)}}{X_{(n)} - X_{(1)}}$
  - 对于中等样本（8 ≤ n ≤ 12）：$r_{11} = \frac{X_{(n)} - X_{(n-1)}}{X_{(n)} - X_{(2)}}$ 或 $r_{11} = \frac{X_{(2)} - X_{(1)}}{X_{(n-1)} - X_{(1)}}$
  - 对于较大样本（13 ≤ n ≤ 30）：$r_{21} = \frac{X_{(n)} - X_{(n-2)}}{X_{(n)} - X_{(2)}}$ 或 $r_{21} = \frac{X_{(3)} - X_{(1)}}{X_{(n-1)} - X_{(1)}}$
- **判断准则**：若r值 > 临界值，则判定为异常值

#### 1.3 Cochran最大方差检验
- **适用条件**：检验多个方差中的异常大方差
- **检验统计量**：$C = \frac{s_{\text{max}}^2}{\sum_{i=1}^k s_i^2}$
- **判断准则**：若C > 临界值，则判定为异常方差

#### 1.4 Tietjen-Moore检验
- **适用条件**：检验多个异常值
- **检验统计量**：基于样本均值和标准差的调整
- **判断准则**：通过迭代方法确定多个异常值

### 2. 适用于非正态分布的检验方法

#### 2.1 中位数绝对偏差（MAD）方法
- **原理**：使用中位数而非均值来度量数据集中趋势，对异常值不敏感
- **计算方法**：
  1. 计算所有数据与中位数的绝对偏差
  2. 计算这些绝对偏差的中位数（MAD）
  3. 异常值判定：$|X_i - \text{Median}| > k \times \text{MAD}$，通常k=3.5

#### 2.2 IQR方法（四分位距法）
- **原理**：利用四分位数来识别异常值
- **计算方法**：
  1. 计算第一四分位数（Q1）和第三四分位数（Q3）
  2. 计算四分位距：IQR = Q3 - Q1
  3. 异常值判定：
     - 下限：Q1 - 1.5 × IQR
     - 上限：Q3 + 1.5 × IQR
     - 超出上下限的数据点被视为异常值

#### 2.3 Hampel方法
- **原理**：基于中位数和MAD的稳健异常值检测方法，对多个异常值具有较强的抵抗力
- **详细内容**：请参考[Hampel异常值检验方法](hampel/README.md)

## 异常值检验的实施流程

根据ISO 16269-4-2010，异常值检验应遵循以下步骤：

1. **确定检验目标**：明确是单侧检验还是双侧检验，是检验单个异常值还是多个异常值
2. **数据分布分析**：评估数据是否符合正态分布或其他假设的分布
3. **选择适当的检验方法**：根据数据特性和检验目标选择合适的检验方法
4. **设定显著性水平**：通常选择α=0.05或α=0.01
5. **计算检验统计量**：根据选定的方法计算相应的统计量
6. **确定临界值**：通过查表或统计软件确定临界值
7. **做出判断**：比较检验统计量和临界值，判断是否存在异常值
8. **异常值处理**：根据判断结果和实际情况决定如何处理异常值

## 异常值的处理原则

ISO 16269-4-2010建议在处理异常值时遵循以下原则：

1. **确认异常值的来源**：
   - 检查是否存在测量错误、记录错误或其他明显原因
   - 分析过程中是否存在特殊原因变异

2. **异常值的处理方法**：
   - **保留并分析**：当异常值反映过程中的真实特殊原因时，应保留并进行深入分析
   - **修正**：当异常值由可识别的错误引起且可更正时，应修正数据
   - **删除**：仅当异常值由明显错误引起且无法修正，且有充分理由证明其不代表过程特性时，才可删除
   - **分离分析**：对包含和不包含异常值的数据分别进行分析，比较结果差异

3. **记录与报告**：
   - 详细记录异常值检验的方法、结果和处理方式
   - 在最终报告中说明异常值的存在及其对分析结果的潜在影响

## 应用场景

异常值检验在以下质量管理场景中特别重要：

- 过程数据的预处理和验证
- 控制图数据的异常点识别
- 过程能力分析前的数据筛选
- 实验设计结果的统计分析
- 质量改进项目中的数据分析

## 注意事项

1. **避免过度剔除异常值**：过度剔除可能导致数据失真，影响统计分析的有效性
2. **考虑样本量影响**：小样本中异常值的影响更大，需要更谨慎地处理
3. **结合专业知识**：统计检验应与领域专业知识相结合，避免纯统计判断
4. **注意多重检验问题**：多次进行异常值检验会增加误判风险
5. **使用多种方法交叉验证**：不同的检验方法可能得出不同结果，建议使用多种方法进行验证

正确应用异常值检验方法对于确保统计过程控制的有效性至关重要，能够帮助组织更准确地识别过程中的特殊原因变异，采取针对性的改进措施。