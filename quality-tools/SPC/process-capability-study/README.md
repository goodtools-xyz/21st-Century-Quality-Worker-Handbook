# 过程能力研究

## 概念简介

过程能力研究（Process Capability Study）是统计过程控制中的重要组成部分，用于评估过程满足产品规格要求的能力。通过计算过程能力指数，组织可以量化过程的质量水平，识别改进机会，并做出数据驱动的决策。过程能力研究主要包括短期过程能力分析（使用Cp、Cpk指数）和长期过程性能分析（使用Pp、Ppk指数）。

## 过程能力指数概述

### 1. 短期过程能力指数（Cp、Cpk）

短期过程能力指数用于评估过程在受控状态下的固有能力，通常基于过程处于统计控制状态时收集的数据计算。这些指数反映了过程的最佳性能水平。

#### Cp（过程能力指数）

**定义**：Cp指数衡量过程变异相对于规格公差范围的关系，不考虑过程中心与目标值的偏移。

**计算公式**：

$$ Cp = \frac{USL - LSL}{6\sigma_{within}} $$

其中：
- USL = 规格上限
- LSL = 规格下限
- $\sigma_{within}$ = 组内标准差（短期标准差）

**计算条件**：
1. 过程必须处于统计控制状态（无特殊原因变异）
2. 数据应服从正态分布
3. 必须有上下两个规格限
4. 适用于双侧公差的情况

**解释**：
- Cp > 1.33：过程能力充足
- 1.0 ≤ Cp ≤ 1.33：过程能力一般，需要注意控制
- Cp < 1.0：过程能力不足，需要立即改进

#### Cpk（过程能力指数修正值）

**定义**：Cpk指数不仅考虑过程变异，还考虑过程中心与目标值的偏移情况。

**计算公式**：

$$ Cpk = \min\left( \frac{USL - \mu}{3\sigma_{within}}, \frac{\mu - LSL}{3\sigma_{within}} \right) $$

其中：
- USL = 规格上限
- LSL = 规格下限
- $\mu$ = 过程均值
- $\sigma_{within}$ = 组内标准差（短期标准差）

**计算条件**：
1. 过程必须处于统计控制状态
2. 数据应服从正态分布
3. 可以适用于单侧公差或双侧公差的情况
   - 对于单侧上限（只有USL）：$Cpk = \frac{USL - \mu}{3\sigma_{within}}$ 
   - 对于单侧下限（只有LSL）：$Cpk = \frac{\mu - LSL}{3\sigma_{within}}$ 

**解释**：
- Cpk > 1.33：过程能力充足（考虑偏移）
- 1.0 ≤ Cpk ≤ 1.33：过程能力一般，需要注意控制
- Cpk < 1.0：过程能力不足，需要立即改进
- Cpk ≤ 0：过程均值已经超出规格限

### 2. 长期过程性能指数（Pp、Ppk）

长期过程性能指数用于评估过程在实际生产条件下的整体表现，通常基于较长时间内收集的数据计算，包含了过程的所有变异来源。

#### Pp（过程性能指数）

**定义**：Pp指数衡量过程总变异相对于规格公差范围的关系，不考虑过程中心与目标值的偏移。

**计算公式**：

$$ Pp = \frac{USL - LSL}{6\sigma_{overall}} $$

其中：
- USL = 规格上限
- LSL = 规格下限
- $\sigma_{overall}$ = 总标准差（长期标准差）

**计算条件**：
1. 可以在过程不受控状态下计算
2. 数据应服从正态分布
3. 必须有上下两个规格限
4. 适用于双侧公差的情况

**解释**：
- Pp > 1.33：过程性能充足
- 1.0 ≤ Pp ≤ 1.33：过程性能一般
- Pp < 1.0：过程性能不足

#### Ppk（过程性能指数修正值）

**定义**：Ppk指数不仅考虑过程总变异，还考虑过程中心与目标值的偏移情况。

**计算公式**：

$$ Ppk = \min\left( \frac{USL - \mu}{3\sigma_{overall}}, \frac{\mu - LSL}{3\sigma_{overall}} \right) $$

其中：
- USL = 规格上限
- LSL = 规格下限
- $\mu$ = 过程均值
- $\sigma_{overall}$ = 总标准差（长期标准差）

**计算条件**：
1. 可以在过程不受控状态下计算
2. 数据应服从正态分布
3. 可以适用于单侧公差或双侧公差的情况
   - 对于单侧上限（只有USL）：$Ppk = \frac{USL - \mu}{3\sigma_{overall}}$ 
   - 对于单侧下限（只有LSL）：$Ppk = \frac{\mu - LSL}{3\sigma_{overall}}$ 

**解释**：
- Ppk > 1.33：过程性能充足（考虑偏移）
- 1.0 ≤ Ppk ≤ 1.33：过程性能一般
- Ppk < 1.0：过程性能不足
- Ppk ≤ 0：过程均值已经超出规格限

## 标准差的计算方法

### 1. 组内标准差（$\sigma_{within}$）

组内标准差用于计算Cp和Cpk，代表过程的短期变异。常用计算方法包括：

#### 方法一：使用极差法（R-bar/d2）

$$ \sigma_{within} = \frac{\bar{R}}{d_2} $$

其中：
- $\bar{R}$ = 子组极差的平均值
- $d_2$ = 与子组大小相关的常数（可从统计常数表中查得）

| 子组大小(n) | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 |
|------------|---|---|---|---|---|---|---|---|----|
| d2         | 1.128 | 1.693 | 2.059 | 2.326 | 2.534 | 2.704 | 2.847 | 2.970 | 3.078 |

#### 方法二：使用标准差法（s-bar/c4）

$$ \sigma_{within} = \frac{\bar{s}}{c_4} $$

其中：
- $\bar{s}$ = 子组标准差的平均值
- $c_4$ = 与子组大小相关的常数

### 2. 总标准差（$\sigma_{overall}$）

总标准差用于计算Pp和Ppk，代表过程的长期变异。计算方法：

$$ \sigma_{overall} = \sqrt{\frac{\sum_{i=1}^n (x_i - \bar{x})^2}{n-1}} $$

其中：
- $x_i$ = 单个测量值
- $\bar{x}$ = 所有数据的平均值
- n = 数据点总数

## Cp与Cpk、Pp与Ppk的关系

### Cp与Cpk的关系
- Cpk ≤ Cp
- 当过程均值$\mu$等于规格中心值时，Cpk = Cp
- Cp与Cpk的差距反映了过程中心偏移的程度
- 偏移系数（k）：$k = \frac{|\mu - M|}{(USL - LSL)/2}$，其中M是规格中心值
- Cpk = Cp × (1 - k)

### Pp与Ppk的关系
- Ppk ≤ Pp
- 当过程均值$\mu$等于规格中心值时，Ppk = Pp
- Pp与Ppk的差距反映了过程中心偏移的程度
- Ppk = Pp × (1 - k)

## 过程能力与过程性能的比较

### 短期 vs 长期
- **短期能力（Cp、Cpk）**：反映过程在理想条件下的最佳表现，不考虑时间引起的变异
- **长期性能（Pp、Ppk）**：反映过程在实际生产环境中的整体表现，包括时间引起的变异

### 变异来源
- **组内变异**：同一子组内的随机变异，是过程的固有变异
- **组间变异**：不同子组间的变异，可能包含系统性变异
- $\sigma_{overall}^2 = \sigma_{within}^2 + \sigma_{between}^2$

### 典型关系
- Cp > Pp
- Cpk > Ppk
- 如果Cp ≈ Pp且Cpk ≈ Ppk，说明过程稳定
- 如果Cp >> Pp且Cpk >> Ppk，说明过程存在不稳定的变异来源

## 过程能力研究的实施步骤

1. **确定研究目标和范围**
   - 明确要评估的关键质量特性
   - 确定评估的时间段（短期或长期）

2. **收集数据**
   - 短期研究：收集至少25个子组，每个子组3-5个样本
   - 长期研究：收集足够多的数据点（通常100个以上）
   - 确保数据收集的随机性和代表性

3. **数据验证**
   - 检查数据的正态性（使用直方图、正态概率图、Shapiro-Wilk检验等）
   - 对于非正态数据，考虑进行数据转换或使用非正态过程能力指数

4. **过程稳定性分析**
   - 绘制控制图，检查过程是否处于统计控制状态
   - 识别并消除特殊原因变异

5. **计算过程能力指数**
   - 根据数据类型和研究目的，选择合适的指数（Cp、Cpk、Pp、Ppk）
   - 正确计算标准差（组内或总标准差）

6. **分析结果**
   - 评估过程能力是否满足要求
   - 识别改进机会（减少变异或调整过程中心）

7. **制定改进计划**
   - 针对发现的问题制定具体的改进措施
   - 设定合理的目标值

8. **监控和验证**
   - 定期重新评估过程能力
   - 验证改进措施的有效性

## 应用场景

### 短期过程能力研究（Cp、Cpk）
- 新产品或新工艺的初始评估
- 过程改进后的效果验证
- 设备验收和确认
- 供应商质量评估

### 长期过程性能研究（Pp、Ppk）
- 批量生产过程的持续监控
- 客户要求的长期质量保证
- 质量体系审核
- 年度质量回顾

## 注意事项

1. **数据正态性**
   - 过程能力指数假设数据服从正态分布
   - 对于非正态数据，应先进行正态性检验，必要时进行数据转换

2. **过程稳定性**
   - 在计算Cp和Cpk之前，必须确保过程处于统计控制状态
   - 对于不受控的过程，Cp和Cpk可能给出误导性的结果

3. **样本量**
   - 确保有足够的样本量以获得可靠的结果
   - 小样本可能导致指数估计不准确

4. **规格限的合理性**
   - 规格限应基于客户需求和产品功能要求
   - 不合理的规格限会影响过程能力的正确评估

5. **单侧公差情况**
   - 对于只有上限或下限的情况，应使用单侧过程能力指数
   - 此时Cp和Pp不适用，应直接使用Cpk或Ppk

6. **指数解读**
   - 过程能力指数只是一个参考指标，应结合实际情况进行综合分析
   - 不同行业和产品可能有不同的能力要求标准

通过正确理解和应用过程能力指数，可以帮助组织有效评估过程质量水平，识别改进机会，持续提升产品和服务质量，满足客户需求。